<div class="comment" style="margin-left: {{ level|default:0 }}px">
    
    <div class="comment-header">
        <a class="vote-arrow" href="{% url 'upvote' comment.id %}">â–²</a>
        {{ comment.author.username }}
        <span class="comment-time">{{ comment.created_at|timesince }} ago</span>

        {% if user.is_authenticated and user == comment.author %}
          | <a href="{% url 'comments:edit_comment' comment.id %}">edit</a>
          | <a href="{% url 'comments:delete_comment' comment.id %}">delete</a>
        {% endif %}
    </div>

    <div class="comment-body">
        {{ comment.text }}
    </div>

    {% if user.is_authenticated %}
        <a href="#"
           class="reply-link"
           onclick="document.getElementById('reply-form-{{ comment.id }}').style.display='block'; return false;">
            reply
        </a>
    {% endif %}

    <div id="reply-form-{{ comment.id }}" class="reply-form" style="display:none;">
        <form method="POST" action="{% url 'comments:add_comment' comment.submission.id %}">
            {% csrf_token %}
            <input type="hidden" name="parent_id" value="{{ comment.id }}">
            <textarea name="content" rows="2" placeholder="Reply to this comment" required></textarea>
            <button type="submit">Reply</button>
        </form>
    </div>

    {% for reply in comment.replies.all %}
        {% include 'comments/comment_item.html' with comment=reply level=level|add:20 %}
    {% endfor %}
</div>
